---
import '../styles/global.css';
import TopBar from '../components/TopBar.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import { getLangFromUrl, getAlternateUrls, removeLocalePrefix, type Locale } from '../i18n/utils';

interface Props {
	title?: string;
	description?: string;
	currentPath?: string;
	ogImage?: string;
	ogType?: string;
	articleAuthor?: string;
	articlePublishedTime?: string;
}

const {
	title = 'INSESO',
	description = 'Instituto Nacional de Seguridad Social de Guinea Ecuatorial',
	currentPath = Astro.url.pathname,
	ogImage = '/images/logo_01.png',
	ogType = 'website',
	articleAuthor,
	articlePublishedTime
} = Astro.props;

// Detectar idioma actual
const lang = getLangFromUrl(Astro.url);

// Mapa de locales para Open Graph
const ogLocales: Record<Locale, string> = {
	es: 'es_GQ',
	fr: 'fr_FR',
	en: 'en_US',
	pt: 'pt_PT'
};

// Mapa de hreflang ISO est√°ndar
const hreflangMap: Record<Locale, string> = {
	es: 'es',
	fr: 'fr',
	en: 'en',
	pt: 'pt'
};

// URLs alternativas para hreflang
const siteUrl = Astro.site || Astro.url.origin;
const basePath = removeLocalePrefix(currentPath);
const alternateUrls = getAlternateUrls(basePath, siteUrl);
const canonicalURL = new URL(Astro.url.pathname, siteUrl).href;
const fullOgImage = new URL(ogImage, siteUrl).href;
---

<!DOCTYPE html>
<html lang={lang}>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content={description}>
	<meta name="author" content="INSESO">
	<link href="/images/favicon.png" rel="icon">
	<link rel="canonical" href={canonicalURL} />

	<!-- Hreflang tags for multilingual SEO (ISO standard codes) -->
	{Object.entries(alternateUrls).map(([locale, url]) => (
		<link rel="alternate" hreflang={hreflangMap[locale as Locale]} href={url} />
	))}
	<link rel="alternate" hreflang="x-default" href={alternateUrls.es} />
	<!-- Self-referential alternate link -->
	<link rel="alternate" hreflang={hreflangMap[lang]} href={canonicalURL} />

	<title>{title}</title>

	<!-- Preconnect to external resources for faster loading -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="preconnect" href="https://cdn.jsdelivr.net">
	<link rel="dns-prefetch" href="https://fonts.googleapis.com">
	<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

	<!-- Preload critical fonts -->
	<link rel="preload" href="https://fonts.gstatic.com/s/worksans/v19/QGY_z_wNahGAdqQ43RhVcIgYT2Xz5u32K0nWNigDp6_cOyA.woff2" as="font" type="font/woff2" crossorigin>

	<!-- Open Graph Meta Tags -->
	<meta property="og:title" content={title} />
	<meta property="og:description" content={description} />
	<meta property="og:type" content={ogType} />
	<meta property="og:url" content={canonicalURL} />
	<meta property="og:image" content={fullOgImage} />
	<meta property="og:site_name" content="INSESO" />
	<meta property="og:locale" content={ogLocales[lang]} />
	{Object.entries(ogLocales).filter(([l]) => l !== lang).map(([, locale]) => (
		<meta property="og:locale:alternate" content={locale} />
	))}
	{articlePublishedTime && (
		<meta property="article:published_time" content={articlePublishedTime} />
	)}
	{articleAuthor && (
		<meta property="article:author" content={articleAuthor} />
	)}

	<!-- Twitter Card Meta Tags -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:title" content={title} />
	<meta name="twitter:description" content={description} />
	<meta name="twitter:image" content={fullOgImage} />
	<meta name="twitter:site" content="@INSESO_GQ" />

	<!-- Additional SEO Meta Tags -->
	<meta name="robots" content="index, follow" />
	<meta name="language" content={lang === 'es' ? 'Spanish' : lang === 'fr' ? 'French' : lang === 'en' ? 'English' : 'Portuguese'} />

	<!-- CSS Files -->
	<link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/all.css" rel="stylesheet">
	<link href="/css/owl.carousel.min.css" rel="stylesheet">
	<link href="/css/owl.carousel_2.css" rel="stylesheet">
	<link href="/css/owl.theme_2.css" rel="stylesheet">
	<link href="/css/style.css" rel="stylesheet">
	<link href="/css/style_2.css" rel="stylesheet">
	<link href="/css/responsive_2.css" rel="stylesheet">

	<!-- Custom adjustments -->
	<link href="/css/custom-adjustments.css" rel="stylesheet">
	<link href="/css/navbar-improvements.css?v=2" rel="stylesheet">
	<link href="/css/news-improvements.css" rel="stylesheet">
	<link href="/css/hero-improvements.css?v=3" rel="stylesheet">
	<link href="/css/footer-improvements.css" rel="stylesheet">
</head>
<body>
	<div class="wrapper-main">
		<TopBar />
		<Navbar currentPath={currentPath} />

		<slot />

		<Footer />
	</div>

	<!-- Scripts -->
	<script is:inline src="/vendor/jquery/jquery.min.js"></script>
	<script is:inline src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script is:inline src="/js/owl.carousel.min.js"></script>
	<script is:inline src="/js/init-partners-carousel.js"></script>
	<script is:inline src="/js/navbar-toggle.js"></script>
</body>
</html>
