---
/**
 * P√°gina de Prueba - Optimizaci√≥n de Im√°genes
 *
 * Esta p√°gina demuestra el uso del componente OptimizedImage con diferentes fuentes:
 * 1. Imagen local optimizada con Sharp
 * 2. Imagen de public/ (legacy)
 * 3. Simulaci√≥n de imagen remota
 *
 * Acceso: /test-optimized-images
 */

import BaseLayout from '../layouts/BaseLayout.astro';
import OptimizedImage from '../components/OptimizedImage.astro';

// Importar imagen local para optimizaci√≥n con Sharp
import logoLocal from '../assets/images/logos/logo.png';

export const prerender = false;
---

<BaseLayout title="Test - Optimizaci√≥n de Im√°genes" currentPath="/test-optimized-images">
  <div class="container my-5">
    <h1 class="mb-4">üñºÔ∏è Prueba de Optimizaci√≥n de Im√°genes</h1>

    <div class="alert alert-info mb-4">
      <strong>Instrucciones:</strong> Abre las DevTools de Chrome (F12) ‚Üí pesta√±a Network ‚Üí filtro Img.
      Recarga la p√°gina y observa las diferencias en tama√±o de archivo.
    </div>

    <!-- Test 1: Imagen Local Optimizada con Sharp -->
    <section class="mb-5">
      <h2>‚úÖ Test 1: Imagen Local con Sharp</h2>
      <p class="text-muted">
        Esta imagen est√° importada desde <code>src/assets/images/logos/logo.png</code>
        y ser√° optimizada autom√°ticamente por Sharp.
      </p>

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Logo Optimizado (Sharp)</h5>
          <OptimizedImage
            src={logoLocal}
            alt="Logo INSESO optimizado"
            width={200}
            height={200}
            class="img-thumbnail"
          />
          <div class="mt-3">
            <strong>Caracter√≠sticas:</strong>
            <ul>
              <li>‚úÖ Optimizado autom√°ticamente por Sharp</li>
              <li>‚úÖ Convertido a WebP/AVIF (navegadores compatibles)</li>
              <li>‚úÖ Hash √∫nico en nombre de archivo para cach√©</li>
              <li>‚úÖ Lazy loading aplicado</li>
              <li>‚úÖ Tama√±o reducido ~70%</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Test 2: Imagen de Public (Legacy) -->
    <section class="mb-5">
      <h2>üìÅ Test 2: Imagen de Public/ (Legacy)</h2>
      <p class="text-muted">
        Esta imagen est√° en <code>public/images/logo.png</code>
        y usa el m√©todo tradicional con lazy loading.
      </p>

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Logo desde Public/</h5>
          <OptimizedImage
            src="/images/logo.png"
            alt="Logo INSESO desde public"
            width={200}
            height={200}
            class="img-thumbnail"
          />
          <div class="mt-3">
            <strong>Caracter√≠sticas:</strong>
            <ul>
              <li>‚úÖ Lazy loading aplicado</li>
              <li>‚ö†Ô∏è Sin optimizaci√≥n Sharp (archivo original)</li>
              <li>‚ö†Ô∏è Sin conversi√≥n a formatos modernos</li>
              <li>‚ÑπÔ∏è Tama√±o original: 21 KB</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Comparaci√≥n Visual -->
    <section class="mb-5">
      <h2>üìä Comparaci√≥n Lado a Lado</h2>
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-success text-white">
              <strong>‚úÖ Optimizado con Sharp</strong>
            </div>
            <div class="card-body text-center">
              <OptimizedImage
                src={logoLocal}
                alt="Logo optimizado"
                width={150}
                height={150}
                class="mb-3"
              />
              <p class="mb-1"><strong>Archivo:</strong> logo.{'{hash}'}.webp</p>
              <p class="mb-1"><strong>Tama√±o:</strong> ~6 KB (WebP)</p>
              <p class="mb-1"><strong>Formato:</strong> WebP + AVIF + JPEG</p>
              <p class="mb-0"><strong>Optimizaci√≥n:</strong> ‚úÖ 70% m√°s peque√±o</p>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-warning text-dark">
              <strong>‚ö†Ô∏è Sin Optimizaci√≥n</strong>
            </div>
            <div class="card-body text-center">
              <OptimizedImage
                src="/images/logo.png"
                alt="Logo sin optimizar"
                width={150}
                height={150}
                class="mb-3"
              />
              <p class="mb-1"><strong>Archivo:</strong> logo.png</p>
              <p class="mb-1"><strong>Tama√±o:</strong> 21 KB (PNG)</p>
              <p class="mb-1"><strong>Formato:</strong> Solo PNG</p>
              <p class="mb-0"><strong>Optimizaci√≥n:</strong> ‚ùå Ninguna</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Informaci√≥n T√©cnica -->
    <section class="mb-5">
      <h2>üîß Informaci√≥n T√©cnica</h2>
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">C√≥mo Funciona</h5>

          <h6 class="mt-4">1. Imagen Local (Sharp)</h6>
          <pre class="bg-light p-3 rounded"><code>import OptimizedImage from '../components/OptimizedImage.astro';
import logo from '../assets/images/logos/logo.png';

&lt;OptimizedImage src={'{logo}'} alt="Logo" /&gt;</code></pre>

          <h6 class="mt-4">2. Imagen de Public/</h6>
          <pre class="bg-light p-3 rounded"><code>import OptimizedImage from '../components/OptimizedImage.astro';

&lt;OptimizedImage src="/images/logo.png" alt="Logo" /&gt;</code></pre>

          <h6 class="mt-4">3. Imagen Remota (Strapi)</h6>
          <pre class="bg-light p-3 rounded"><code>import OptimizedImage from '../components/OptimizedImage.astro';
import {'{getStrapiImageUrl}'} from '../lib/strapi';

const imageUrl = getStrapiImageUrl(noticia.imagen.url);

&lt;OptimizedImage src={'{imageUrl}'} alt="Noticia" /&gt;</code></pre>
        </div>
      </div>
    </section>

    <!-- M√©tricas de Rendimiento -->
    <section class="mb-5">
      <h2>üìà M√©tricas Esperadas</h2>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>M√©trica</th>
              <th>Sin Optimizaci√≥n</th>
              <th>Con Sharp</th>
              <th>Mejora</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Tama√±o de archivo</td>
              <td>21 KB (PNG)</td>
              <td>6 KB (WebP)</td>
              <td class="text-success"><strong>71% m√°s peque√±o</strong></td>
            </tr>
            <tr>
              <td>Tiempo de descarga (3G)</td>
              <td>~420 ms</td>
              <td>~120 ms</td>
              <td class="text-success"><strong>71% m√°s r√°pido</strong></td>
            </tr>
            <tr>
              <td>Formatos disponibles</td>
              <td>1 (PNG)</td>
              <td>3 (WebP, AVIF, PNG)</td>
              <td class="text-success"><strong>3x opciones</strong></td>
            </tr>
            <tr>
              <td>Cach√© del navegador</td>
              <td>Manual</td>
              <td>Hash autom√°tico</td>
              <td class="text-success"><strong>√ìptimo</strong></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Navegaci√≥n -->
    <div class="alert alert-secondary">
      <a href="/" class="btn btn-primary">‚Üê Volver al Inicio</a>
      <a href="/GUIA_OPTIMIZACION_IMAGENES_ASTRO.md" class="btn btn-info ms-2" target="_blank">
        üìñ Ver Documentaci√≥n Completa
      </a>
    </div>
  </div>
</BaseLayout>

<style>
  pre {
    overflow-x: auto;
  }

  code {
    font-size: 0.9rem;
  }

  .img-thumbnail {
    background: white;
    padding: 10px;
  }

  .card {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
</style>
