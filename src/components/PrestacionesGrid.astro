---
/**
 * Componente PrestacionesGrid - Grid de todas las prestaciones sociales
 *
 * Este componente muestra el grid de 9 prestaciones.
 * Cuando el Content Type de Prestaciones esté configurado en Strapi,
 * se puede pasar el array de prestaciones como prop.
 *
 * @param {Array} prestaciones - Array de prestaciones (opcional)
 * @param {boolean} usarStrapi - Si debe cargar datos de Strapi (default: false)
 */

import type { Prestacion } from '../lib/strapi';
import { getPrestaciones, getStrapiImageUrl } from '../lib/strapi';
import { getLangFromUrl, useTranslations, getLocalizedPath } from '../i18n/utils';

interface Props {
  prestaciones?: Prestacion[];
  usarStrapi?: boolean;
}

const { prestaciones: prestacionesProp, usarStrapi = false } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Datos estáticos (se usan hasta que Strapi esté configurado)
// Ahora usan URLs dinámicas con formato /prestacion/slug
const prestacionesEstaticas = [
  {
    titulo: 'Prestaciones Médico-Farmacéuticas',
    slug: '/prestacion/prestaciones-medico-farmaceuticas',
    imagen: '/images/prestaciones/prestaciones_img_01.jpg',
    espacioBr: false
  },
  {
    titulo: 'Subsidio de incapacidad temporal',
    slug: '/prestacion/subsidio-de-incapacidad-temporal',
    imagen: '/images/prestaciones/prestaciones_img_02.jpg',
    espacioBr: true
  },
  {
    titulo: 'Subsidio por maternidad',
    slug: '/prestacion/subsidio-por-maternidad',
    imagen: '/images/prestaciones/prestaciones_img_03.jpg',
    espacioBr: true
  },
  {
    titulo: 'Prestaciones por invalidez',
    slug: '/prestacion/prestaciones-por-invalidez',
    imagen: '/images/prestaciones/prestaciones_img_04.jpg',
    espacioBr: true
  },
  {
    titulo: 'Pensión por vejez',
    slug: '/prestacion/pension-por-vejez',
    imagen: '/images/prestaciones/prestaciones_img_05.jpg',
    espacioBr: true
  },
  {
    titulo: 'Prestaciones por muerte y supervivencia',
    slug: '/prestacion/prestaciones-por-muerte-y-supervivencia',
    imagen: '/images/prestaciones/prestaciones_img_06.jpg',
    espacioBr: false
  },
  {
    titulo: 'Protección al empleo',
    slug: '/prestacion/proteccion-al-empleo',
    imagen: '/images/prestaciones/prestaciones_img_07.jpg',
    espacioBr: true
  },
  {
    titulo: 'Subsidios familiares',
    slug: '/prestacion/subsidios-familiares',
    imagen: '/images/prestaciones/prestaciones_img_08.jpg',
    espacioBr: true
  },
  {
    titulo: 'Servicios sociales',
    slug: '/prestacion/servicios-sociales',
    imagen: '/images/prestaciones/prestaciones_img_09.jpg',
    espacioBr: true
  }
];

// Determinar qué datos usar
let prestacionesData;

if (usarStrapi) {
  // Cargar desde Strapi con el idioma correcto
  const prestacionesStrapi = prestacionesProp || await getPrestaciones(lang);
  prestacionesData = prestacionesStrapi.map(p => ({
    titulo: p.titulo,
    slug: `/prestacion/${p.slug}`, // URL dinámica directa
    imagen: p.imagen ? getStrapiImageUrl(p.imagen.url) : '/images/default.jpg',
    espacioBr: true
  }));
} else {
  // Usar datos estáticos
  prestacionesData = prestacionesEstaticas;
}
---

<div class="services-bar">
  <div class="container">
    <div class="row">
      {prestacionesData.map((prestacion) => {
        const prestacionUrl = getLocalizedPath(prestacion.slug, lang);
        return (
          <div class="col-lg-4 mb-4">
            <div class="card h-100">
              <div class="card-img">
                <img class="img-fluid" src={prestacion.imagen} alt={prestacion.titulo} />
              </div>
              <div class="card-body">
                <h4 class="card-header">{prestacion.titulo}</h4>
                {prestacion.espacioBr && <br>}
                <a href={prestacionUrl} class="btn btn-primary">{t('common.readMore')} &rarr;</a>
              </div>
            </div>
          </div>
        );
      })}
    </div>
  </div>
</div>
