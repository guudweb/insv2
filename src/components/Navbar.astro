---
// Navbar component - Barra de navegación principal con soporte multiidioma
import LanguageSwitcher from './LanguageSwitcher.astro';
import { getLangFromUrl, useTranslations, getLocalizedPath } from '../i18n/utils';

const { currentPath = '/' } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<nav class="navbar navbar-expand-lg navbar-dark bg-light top-nav">
	<!-- Language Switcher para desktop (fuera del container, fijo a la derecha) -->
	<div class="lang-switcher-desktop d-none d-lg-block">
		<LanguageSwitcher currentLang={lang} currentPath={currentPath} />
	</div>

	<div class="container">
		<a class="navbar-brand" href={getLocalizedPath('/', lang)}>
			<img src="/images/logo.png" alt="INSESO" />
		</a>
		<button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
			<span class="fas fa-bars"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarResponsive">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class={`nav-link ${currentPath === '/' ? 'active' : ''}`} href={getLocalizedPath('/', lang)}>{t('nav.home')}</a>
				</li>
				<li class="nav-item">
					<a class={`nav-link ${currentPath === '/noticias' ? 'active' : ''}`} href={getLocalizedPath('/noticias', lang)}>{t('nav.news')}</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" href="#" id="navbarDropdownAbout" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{t('nav.about')}<i class="fas fa-sort-down"></i></a>
					<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownAbout">
						<a class="dropdown-item" href={getLocalizedPath('/sobre_nosotros', lang)}>{t('nav.aboutPresentation')}</a>
						<a class="dropdown-item" href={getLocalizedPath('/Prestaciones_Sociales', lang)}>{t('nav.aboutServices')}</a>
						<a class="dropdown-item" href={getLocalizedPath('/condiciones_adhesion', lang)}>{t('nav.aboutConditions')}</a>
						<a class="dropdown-item" href={getLocalizedPath('/nuestras_agencias', lang)}>{t('nav.aboutAgencies')}</a>
					</div>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" href="#" id="navbarDropdownInsured" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{t('nav.insured')}<i class="fas fa-sort-down"></i></a>
					<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownInsured">
						<a class="dropdown-item" href={getLocalizedPath('/afiliacionee_trabajadores', lang)}>{t('nav.insuredConditions')}</a>
						<a class="dropdown-item" href={getLocalizedPath('/descarga_formularios', lang)}>{t('nav.insuredForms')}</a>
						<a class="dropdown-item" href="#">{t('nav.insuredPayments')}</a>
					</div>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" href="#" id="navbarDropdownEmployers" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{t('nav.employers')}<i class="fas fa-sort-down"></i></a>
					<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownEmployers">
						<a class="dropdown-item" href={getLocalizedPath('/afiliacionee_empresas', lang)}>{t('nav.employersConditions')}</a>
						<a class="dropdown-item" href={getLocalizedPath('/descarga_formularios', lang)}>{t('nav.employersForms')}</a>
						<a class="dropdown-item" href="#">{t('nav.employersPayments')}</a>
						<a class="dropdown-item" href={getLocalizedPath('/empleadores/penas-sanciones', lang)}>{t('nav.employersPenalties')}</a>
					</div>
				</li>
				<li class="nav-item">
					<a class="nav-link" href={getLocalizedPath('/contacto', lang)}>{t('nav.contact')}</a>
				</li>
			</ul>

			<!-- Language Switcher para móvil (dentro del menú colapsable) -->
			<div class="lang-switcher-mobile d-lg-none">
				<LanguageSwitcher currentLang={lang} currentPath={currentPath} />
			</div>
		</div>
	</div>
</nav>

<style is:global>
	/* Desktop: Language switcher fijo al extremo derecho, fuera del container */
	@media (min-width: 992px) {
		.top-nav {
			position: relative;
		}

		.lang-switcher-desktop {
			position: absolute;
			right: 1.5rem;
			top: 50%;
			transform: translateY(-50%);
			z-index: 100;
		}
	}

	/* Mobile: Language switcher dentro del menú colapsable */
	@media (max-width: 991px) {
		.lang-switcher-mobile {
			margin-top: 1rem;
			padding-top: 1rem;
			border-top: 1px solid rgba(0, 0, 0, 0.1);
			width: 100%;
		}

		.lang-switcher-mobile .language-switcher .dropdown-menu {
			position: relative !important;
			width: 100%;
			margin-top: 0.5rem;
			transform: none !important;
			top: auto !important;
		}
	}
</style>
