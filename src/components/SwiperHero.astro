---
// Swiper Hero Carousel - Más fácil de manejar que Bootstrap
import type { HeroSlide } from '../lib/strapi';
import { getStrapiImageUrl } from '../lib/strapi';

interface Props {
	slides?: HeroSlide[];
}

const { slides: heroSlides = [] } = Astro.props;

// Fallback a slides estáticos si no hay datos de Strapi
const defaultSlides = [
	{ image: '/images/accueil/slider-00.jpg' },
	{ image: '/images/accueil/slider-01.jpg' },
	{ image: '/images/accueil/slider-02.jpg' },
	{ image: '/images/accueil/slider-03.jpg' },
	{ image: '/images/accueil/slider-04.jpg' },
	{ image: '/images/accueil/slider-05.jpg' },
	{ image: '/images/accueil/slider-06.jpg' }
];

type ProcessedSlide = {
	image: string;
	title?: string;
	subtitle?: string;
	link?: string;
	buttonText?: string;
};

const slides: ProcessedSlide[] = heroSlides.length > 0
	? heroSlides.map(slide => ({
			image: getStrapiImageUrl(slide.imagen.url),
			title: slide.titulo,
			subtitle: slide.subtitulo,
			link: slide.enlace,
			buttonText: slide.textoBoton
		}))
	: defaultSlides;
---

<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<header class="hero-swiper">
	<div class="swiper heroSwiper">
		<div class="swiper-wrapper">
			{slides.map((slide, index) => (
				<div class="swiper-slide">
					<img
						src={slide.image}
						alt={slide.title || 'INSESO'}
						fetchpriority={index === 0 ? 'high' : 'low'}
						loading={index === 0 ? 'eager' : 'lazy'}
					/>
					{slide.title && (
						<div class="swiper-caption d-none d-md-block">
							{slide.title && <h2>{slide.title}</h2>}
							{slide.subtitle && <p>{slide.subtitle}</p>}
							{slide.link && slide.buttonText && (
								<a href={slide.link} class="btn btn-primary">{slide.buttonText}</a>
							)}
						</div>
					)}
				</div>
			))}
		</div>

		<!-- Navigation -->
		<div class="swiper-button-next"></div>
		<div class="swiper-button-prev"></div>

		<!-- Pagination -->
		<div class="swiper-pagination"></div>
	</div>
</header>

<style>
	.hero-swiper {
		width: 100%;
		height: 50vh;
		min-height: 400px;
	}

	@media (max-width: 767px) {
		.hero-swiper {
			height: 35vh;
			min-height: 250px;
			max-height: 350px;
		}
	}

	.heroSwiper {
		width: 100%;
		height: 100%;
	}

	.swiper-slide {
		position: relative;
		overflow: hidden;
	}

	.swiper-slide img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		object-position: center;
	}

	.swiper-caption {
		position: absolute;
		bottom: 20%;
		left: 50%;
		transform: translateX(-50%);
		text-align: center;
		color: white;
		z-index: 10;
		width: 90%;
	}

	.swiper-caption h2 {
		font-size: 48px;
		font-weight: 700;
		text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
	}

	.swiper-caption p {
		font-size: 24px;
		text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
	}

	/* Estilo de botones de navegación */
	.swiper-button-next,
	.swiper-button-prev {
		color: #8c1b12;
		background: rgba(255,255,255,0.8);
		width: 44px;
		height: 44px;
		border-radius: 50%;
	}

	.swiper-button-next:after,
	.swiper-button-prev:after {
		font-size: 20px;
	}

	/* Paginación */
	.swiper-pagination-bullet {
		background: #8c1b12;
		opacity: 0.5;
	}

	.swiper-pagination-bullet-active {
		opacity: 1;
	}

	@media (max-width: 767px) {
		.swiper-caption {
			display: none;
		}

		.swiper-button-next,
		.swiper-button-prev {
			width: 30px;
			height: 30px;
		}

		.swiper-button-next:after,
		.swiper-button-prev:after {
			font-size: 16px;
		}
	}
</style>

<!-- Swiper JS -->
<script is:inline src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script is:inline>
	document.addEventListener('DOMContentLoaded', function() {
		new Swiper('.heroSwiper', {
			loop: true,
			autoplay: {
				delay: 5000,
				disableOnInteraction: false,
			},
			speed: 800,
			effect: 'fade',
			fadeEffect: {
				crossFade: true
			},
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			navigation: {
				nextEl: '.swiper-button-next',
				prevEl: '.swiper-button-prev',
			},
		});
	});
</script>
